{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kim Apartment</title>
  <link rel="stylesheet" href="{% static 'css/index.css' %}">
</head>
<body>

<!-- ğŸ”¹ Navbar -->
<div class="navbar">
  <div class="logo"><h1>Kim Apartment</h1></div>
  <div class="auth-buttons">
    <a href="{% url 'login' %}">à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š</a>
    <a href="{% url 'register' %}">à¸ªà¸¡à¸±à¸„à¸£à¸ªà¸¡à¸²à¸Šà¸´à¸</a>
  </div>
</div>

<!-- ğŸ”¹ Room Cards -->
<div class="container">
  <h1>à¸£à¸²à¸¢à¸à¸²à¸£à¸«à¹‰à¸­à¸‡à¸à¸±à¸</h1>
  <div class="room-list">
    {% for room in rooms %}
    <div class="room-card">
      <img src="{{ room.image.url }}" 
           alt="à¸£à¸¹à¸›à¸«à¹‰à¸­à¸‡ {{ room.room_number }}"
           onclick="openModal(this)"
           data-src="{{ room.image.url }}"
           data-room="{{ room.room_number }}"
           data-type="{{ room.room_type }}"
           data-size="{{ room.size }}"
           data-rent="{{ room.rent_price }}"
           data-elec="{{ room.electricity_price }}"
           data-water="{{ room.water_price }}"
           data-status="{{ room.status }}"
           data-amenities="{{ room.get_facilities_list|join:',' }}">
      <h2>à¸«à¹‰à¸­à¸‡ {{ room.room_number }}</h2>
      <p class="status">
        à¸ªà¸–à¸²à¸™à¸°: 
        {% if room.status == "available" %}
          <span class="status-available">âœ… à¸§à¹ˆà¸²à¸‡</span>
        {% elif room.status == "occupied" %}
          <span class="status-occupied">âŒ à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‡</span>
        {% elif room.status == "reserved" %}
          <span class="status-reserved">ğŸ”¶ à¸•à¸´à¸”à¸ˆà¸­à¸‡</span>
        {% endif %}
      </p>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ğŸ”¹ Modal -->
<div id="roomModal" class="modal">
  <div class="modal-inner">
    <span class="close" onclick="closeModal()">&times;</span>
    <img id="modalImage" src="" class="modal-img" />

    <div class="modal-details">
      <h2>à¸«à¹‰à¸­à¸‡ <span id="modalRoomNumber"></span> (<span id="modalRoomType"></span>)</h2>
      <ul>
        <li><strong>à¸‚à¸™à¸²à¸” </strong> <span id="modalSize"></span> à¸•à¸£.à¸¡.</li>
        <li><strong>à¸„à¹ˆà¸²à¹€à¸Šà¹ˆà¸² </strong> <span id="modalRent"></span> à¸šà¸²à¸—/à¹€à¸”à¸·à¸­à¸™</li>
        <li><strong>à¸„à¹ˆà¸²à¹„à¸Ÿ </strong> <span id="modalElec"></span> à¸šà¸²à¸—/à¸«à¸™à¹ˆà¸§à¸¢</li>
        <li><strong>à¸„à¹ˆà¸²à¸™à¹‰à¸³ </strong> <span id="modalWater"></span> à¸šà¸²à¸—/à¸«à¸™à¹ˆà¸§à¸¢</li>
        <li><strong>à¸ªà¸–à¸²à¸™à¸° </strong> <span id="modalStatus"></span></li>
      </ul>
      <div class="modal-amenities">
        <strong>à¸ªà¸´à¹ˆà¸‡à¸­à¸³à¸™à¸§à¸¢à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸ </strong>
        <div id="modalAmenities" class="amenity-badges"></div>
      </div>
    </div>
  </div>
</div>

<!-- ğŸ”¹ Script -->
<script>
const FACILITY_MAP = {
  "bed": "ğŸ› à¹€à¸•à¸µà¸¢à¸‡",
  "wifi": "ğŸ“¶ Wi-Fi",
  "water_heater": "ğŸš¿ à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸—à¸³à¸™à¹‰à¸³à¸­à¸¸à¹ˆà¸™",
  "parking": "ğŸ…¿ï¸ à¸—à¸µà¹ˆà¸ˆà¸­à¸”à¸£à¸–",
  "kettle": "â˜• à¸à¸²à¸™à¹‰à¸³à¸£à¹‰à¸­à¸™",
  "kitchen": "ğŸ³ à¸„à¸£à¸±à¸§/à¹„à¸¡à¹‚à¸„à¸£à¹€à¸§à¸Ÿ",
  "balcony": "ğŸŒ… à¸£à¸°à¹€à¸šà¸µà¸¢à¸‡",
  "no_smoking": "ğŸš­ à¸«à¹‰à¸²à¸¡à¸ªà¸¹à¸šà¸šà¸¸à¸«à¸£à¸µà¹ˆ",
  "smoking_area": "ğŸš¬ à¸ªà¸¹à¸šà¸šà¸¸à¸«à¸£à¸µà¹ˆ (à¸ à¸²à¸¢à¸™à¸­à¸)",
  "pet_allowed": "ğŸ¶ğŸ± à¸ªà¸±à¸•à¸§à¹Œà¹€à¸¥à¸µà¹‰à¸¢à¸‡à¹€à¸‚à¹‰à¸²à¹„à¸”à¹‰",
  "fridge": "ğŸ§Š à¸•à¸¹à¹‰à¹€à¸¢à¹‡à¸™"
};
function formatNumber(value) {
  const num = parseFloat(value);
  return isNaN(num) ? value : Math.round(num).toLocaleString();
}


function openModal(img) {
  document.getElementById("modalImage").src = img.dataset.src;
  document.getElementById("modalRoomNumber").textContent = img.dataset.room;
  document.getElementById("modalRoomType").textContent = img.dataset.type;
  document.getElementById("modalSize").textContent = formatNumber(img.dataset.size);
  document.getElementById("modalRent").textContent = formatNumber(img.dataset.rent);
  document.getElementById("modalElec").textContent = formatNumber(img.dataset.elec);
  document.getElementById("modalWater").textContent = formatNumber(img.dataset.water);


  const statusMap = {
    "available": "âœ… à¸§à¹ˆà¸²à¸‡",
    "occupied": "âŒ à¹„à¸¡à¹ˆà¸§à¹ˆà¸²à¸‡",
    "reserved": "ğŸ”¶ à¸•à¸´à¸”à¸ˆà¸­à¸‡"
  };
  document.getElementById("modalStatus").textContent = statusMap[img.dataset.status] || img.dataset.status;

  // à¹à¸ªà¸”à¸‡à¸ªà¸´à¹ˆà¸‡à¸­à¸³à¸™à¸§à¸¢à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸
  const amenities = img.dataset.amenities.split(",");
  const modalAmenityDiv = document.getElementById("modalAmenities");
  modalAmenityDiv.innerHTML = "";

  amenities.forEach(function(item) {
    const span = document.createElement("span");
    span.className = "amenity-badge";
    span.textContent = FACILITY_MAP[item.trim()] || item.trim();
    modalAmenityDiv.appendChild(span);
  });

  document.getElementById("roomModal").style.display = "flex";
}

function closeModal() {
  document.getElementById("roomModal").style.display = "none";
}
</script>

</body>
</html>
