{% extends "base.html" %}
{% load static %}
{% block title %}Admin Complaint{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/admin_complaint.css' %}">

<div class="container">
    <div class="header-container">
        <h2>üìã ‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
        <div class="filter-container">
            <label for="statusFilter">‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
            <select id="statusFilter" class="status-dropdown">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
            </select>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á</th>
                    <th>‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="complaintTableBody">
                {% for complaint in complaints %}
                <tr class="complaint-row" data-status="{{ complaint.status }}">
                    <td>{{ complaint.room.room_number }}</td>
                    <td>{{ complaint.description }}</td>
                    <td>
                        {% if complaint.status == "pending" %}
                            <span class="status-pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                        {% elif complaint.status == "approved" %}
                            <span class="status-approved">‚úî ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                        {% elif complaint.status == "rejected" %}
                            <span class="status-rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if complaint.status == "pending" %}
                        <a href="{% url 'update_complaint_status' complaint.id 'approved' %}" 
                        class="btn btn-success"
                        onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')">
                        ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                        </a>

                        <a href="{% url 'update_complaint_status' complaint.id 'rejected' %}" 
                        class="btn btn-danger"
                        onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?')">
                        ‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                        </a>

                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="4" class="no-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- ‚úÖ JavaScript ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
<script>
    document.getElementById("statusFilter").addEventListener("change", function () {
        let filter = this.value;
        let rows = document.querySelectorAll(".complaint-row");

        rows.forEach(row => {
            let status = row.getAttribute("data-status");
            row.style.display = (filter === "all" || status === filter) ? "" : "none";
        });
    });
</script>

{% endblock %}
