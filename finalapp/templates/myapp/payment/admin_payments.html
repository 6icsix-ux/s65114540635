{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load custom_filters %}
{% block title %}Admin Payment{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/admin_payments.css' %}">

<div class="container">
    <div class="header-container">
        <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
        <div class="filter-container">
            <label for="statusFilter">‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
            <select id="statusFilter" class="status-dropdown">
                <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</option>
                <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
            </select>
        </div>
    </div>
    

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>‡∏´‡πâ‡∏≠‡∏á</th>
                    <th>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                    <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ</th> <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏™‡∏•‡∏¥‡∏õ</th>
                    <th>‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
                </tr>
            </thead>            
            <tbody id="paymentTableBody">
                {% for payment in payments %}
                <tr class="payment-row" data-status="{{ payment.status }}">
                    <td>{{ payment.room.room_number|default:"-" }}</td>
                    <td>{{ payment.member.fullname|default:"-" }}</td>
                    <td>{{ payment.amount|floatformat:0|intcomma }} ‡∏ö‡∏≤‡∏ó</td>
                    <td>{{ payment.month_year|thai_month_year }}</td> <!-- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÉ‡∏ä‡πâ‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå format ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ -->
                    <td>
                        {% if payment.status == "pending" %}
                            <span class="status-pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>
                        {% elif payment.status == "approved" %}
                            <span class="status-approved">‚úî ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                        {% elif payment.status == "rejected" %}
                            <span class="status-rejected">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if payment.slip %}
                            <img src="{{ payment.slip.url }}" alt="‡∏™‡∏•‡∏¥‡∏õ" class="payment-slip" onclick="openModal('{{ payment.slip.url }}')">
                        {% else %}
                            ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ
                        {% endif %}
                    </td>
                    <td>
                        {% if payment.status == "pending" %}
                            <a href="{% url 'approve-payment' payment.id %}" class="btn-success" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ?')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a>
                            <a href="{% url 'reject-payment' payment.id %}" class="btn-danger" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏µ‡πâ?')">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="7" class="no-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</td></tr> <!-- ‚úÖ ‡πÅ‡∏Å‡πâ colspan ‡∏à‡∏≤‡∏Å 6 ‡πÄ‡∏õ‡πá‡∏ô 7 ‡∏î‡πâ‡∏ß‡∏¢ -->
                {% endfor %}
            </tbody>
            
        </table>
    </div>
</div>

<!-- ‚úÖ JavaScript ‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
<script>
    document.getElementById("statusFilter").addEventListener("change", function () {
        let filter = this.value;
        console.log("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:", filter);
        let rows = document.querySelectorAll(".payment-row");

        rows.forEach(row => {
            let status = row.getAttribute("data-status");
            row.style.display = (filter === "all" || status === filter) ? "" : "none";
        });
    });

    function openModal(imageUrl) {
        let modal = document.createElement("div");
        modal.classList.add("modal-overlay");

        modal.innerHTML = `
            <div class="modal-content">
                <span class="close-modal" onclick="document.body.removeChild(this.parentElement.parentElement)">‚úñ</span>
                <img class="modal-image" src="${imageUrl}">
            </div>
        `;

        document.body.appendChild(modal);
    }
</script>

{% endblock %}
