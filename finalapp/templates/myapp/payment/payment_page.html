{% extends 'baseuser.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<head>
    <title>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</title>
    <link rel="stylesheet" href="{% static 'css/payment.css' %}">
</head>
<body>
    <div class="payment-container">
        <h2>üí∞ ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>

        <!-- Payment details -->
        <div class="payment-details">
            <p>üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å : <strong>{{ selected_month }}</strong></p>
            <p>üíµ ‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ : <strong class="amount">{{ total_cost|floatformat:0|intcomma }}</strong> ‡∏ö‡∏≤‡∏ó</p>
        </div>

        <!-- QR Code Section -->
        <div class="qr-container">
            <img src="{% static 'images/qrcode.png' %}" alt="QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô" class="qr-code">
        </div>

        <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ -->
        {% if payment %}
            {% if payment.status == 'approved' %}
                <p class="success-message">‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô : <strong>‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</strong></p>
                {% if payment.slip %}
                    <img src="{{ payment.slip.url }}" alt="‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="payment-slip">
                {% endif %}

            {% elif payment.status == 'rejected' %}
                <p class="danger-message">‚ùå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô : <strong>‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà</strong></p>

                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡πÉ‡∏´‡∏°‡πà -->
                <form method="POST" enctype="multipart/form-data" action="{% url 'payment' %}?month={{ selected_month }}">
                    {% csrf_token %}
                    <input type="hidden" name="selected_month" value="{{ selected_month }}">

                    <label>üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô :</label>
                    <input type="file" id="slip-upload" name="slip" accept="image/*" required onchange="previewSlip(event)">

                    <div id="slip-preview-container">
                        <img id="slip-preview" src="#" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ" style="display: none;">
                    </div>

                    <div class="button-container">
                        <button type="submit" class="btn btn-pay">üí∏ ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
                        <a href="{% url 'rent-check' %}" class="btn btn-back">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>
                    </div>
                </form>

            {% elif payment.status == 'pending' %}
                <p class="warning-message">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô : <strong>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</strong></p>

            {% else %}
                <p class="warning-message">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô : <strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</strong></p>

                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ -->
                <form method="POST" enctype="multipart/form-data" action="{% url 'payment' %}?month={{ selected_month }}">
                    {% csrf_token %}
                    <input type="hidden" name="selected_month" value="{{ selected_month }}">

                    <label>üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô :</label>
                    <input type="file" id="slip-upload" name="slip" accept="image/*" required onchange="previewSlip(event)">

                    <div id="slip-preview-container">
                        <img id="slip-preview" src="#" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ" style="display: none;">
                    </div>

                    <div class="button-container">
                        <button type="submit" class="btn btn-pay">üí∏ ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
                        <a href="{% url 'rent-check' %}" class="btn btn-back">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>
                    </div>
                </form>
            {% endif %}
        {% else %}
            <p class="warning-message">‚ö†Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô : <strong>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ä‡∏≥‡∏£‡∏∞</strong></p>

            <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ -->
            <form method="POST" enctype="multipart/form-data" action="{% url 'payment' %}?month={{ selected_month }}">
                {% csrf_token %}
                <input type="hidden" name="selected_month" value="{{ selected_month }}">

                <label>üì§ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô :</label>
                <input type="file" id="slip-upload" name="slip" accept="image/*" required onchange="previewSlip(event)">

                <div id="slip-preview-container">
                    <img id="slip-preview" src="#" alt="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏•‡∏¥‡∏õ" style="display: none;">
                </div>

                <div class="button-container">
                    <button type="submit" class="btn btn-pay">üí∏ ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
                    <a href="{% url 'rent-check' %}" class="btn btn-back">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</a>
                </div>
            </form>
        {% endif %}
    </div>

    <script>
        function previewSlip(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const img = document.getElementById("slip-preview");
                img.src = reader.result;
                img.style.display = "block";
            };
            reader.readAsDataURL(event.target.files[0]);
        }
    </script>
</body>
</html>
{% endblock %}
